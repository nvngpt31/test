#!/bin/bash

  while (( "$#" ))
  do case $1 in
       -f) shift && file="$1"  ;;
       -p) shift && param="$1"  ;;
       -v) shift && value="$1"  ;;
     esac
     shift
  done

  if [[ -z $file ]]      ; then echo "Pass file with -f."   ; exit 1 ; fi 
  if [[ $file = 'all' ]] ; then loop=true ; else loop=false ; fi 

  modsys () {
    file=$1 cmd=$2 method=$3 search=$4 shouldbe=$5 update=$6 replace=$7
    echo "Now modifying file \"$file\""
    echo "Before:"
    grep "^${search}" $file
    echo "" 
    $cmd -m $method -f $file -s "$search" -sh "$shouldbe" -u "$update" -r "$replace"
    echo "After:"
    grep "^${search}" $file
    echo "" 
  }

  cmd="/usr/local/bin/ucm-stringmod.py"
  method='startswith'
  search="${param}"
  shouldbe="${param} = ${value}"
  update='all'
  replace='line'

  if [[ $loop = 'true' ]] 
  then file="/etc/sysctl.conf"
       confs="`ls -1 /etc/sysctl.d`"
       modsys $file $cmd $method "$search" "$shouldbe" "$update" "$replace"
       for i in $confs 
       do mod="/etc/sysctl.d/${i}" 
          modsys $mod $cmd $method "$search" "$shouldbe" "$update" "$replace"
       done 

  else modsys $file $cmd $method "$search" "$shouldbe" "$update" "$replace" 
  fi  


