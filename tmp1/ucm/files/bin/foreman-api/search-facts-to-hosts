#!/bin/bash
  # =====================================================================================
  line='================================================================================='
  while (( "$#" )); do
    case $1 in
      -f|--fact) shift && fact="$1" ;;
      -v|--value) shift && value="$1" ;;
      -c|--count) shift && count=true ;;
    esac
    shift
  done

  if [[ -z $fact || -z $value ]] ; then 
    echo ""
    echo $line
    echo ""
    echo "Please run this script with -p <PARAM NAME> -v <PARAM VALUE>."
    echo ""
    echo $line
    echo ""
    exit 1
  fi 

  # =====================================================================================

  server=$name
  opts='-s -k'
  host="ucmnui.associatesys.local"
  url="https://${host}/api/v2"
  url_h="${url}/hosts?search=facts.${fact}=${value}&per_page=99999"
  # url_h_name="${url}/hosts/${name}"
  user='ucmadmin'
  pw='unity2018'
  h_type='Content-Type:application/json'
  h_accept='Accept:application/json'
  msg_err="resource host not found"

  if [[ $count = 'true' ]] 
  then curl $opts -u "${user}:${pw}" -H "$h_type" -H "$h_accept" $url_h | python -m json.tool | grep certname | sed 's/[\",\,,:,]//g ; s/certname//g ; s/ //g' | wc -l
  else curl $opts -u "${user}:${pw}" -H "$h_type" -H "$h_accept" $url_h | python -m json.tool | grep certname | sed 's/[\",\,,:,]//g ; s/certname//g ; s/ //g' 
  fi 

