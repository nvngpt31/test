########################################################################################
### Contents of this file are managed by UCM/Puppet, you should not edit it manually ###
########################################################################################
#!/bin/bash

  PATH='/usr/lib64/qt-3.3/bin:/usr/ucb:/usr/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/opt/puppet/bin'
  flag='/etc/centrifydc/puppet-ran-initial-adjoin.txt'

  if [[ ! -f $flag ]]
  then domain="<%= $centrify_domain %>" 
       zone="<%= $centrify_zone %>"

       adinfo | grep -qi 'Not joined' >/dev/null 2>&1
       if [[ $? = '0' ]]
       then joined='false'
       else joined='true'
       fi

       if [[ $joined = 'false' ]]
       then adjoin --force -u zUnixADJoin -p 't479788a1!' -c ou=Computers,ou=Unix -z $zone $domain
       else touch $flag
            exit 0
       fi

       sleep 3

       adinfo | grep -qi 'Not joined' >/dev/null 2>&1
       if [[ $? = '0' ]]
       then joined='false'
       else joined='true'
       fi

       if [[ $joined = 'true' ]]
       then touch $flag
            exit 0
       else exit 1
       fi
  fi

